function isMobileOrTablet(){return window.innerWidth<=1024||/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}function saveScrollTriggerState(scope){if(isMobileOrTablet())return;const root=scope||document,scroller=root.querySelector("#scroll");if(!scroller)return;const state={scrollTop:scroller.scrollTop,elements:{}};return root.querySelectorAll('[data-scroll="parallax-component"]').forEach((el,i)=>{if(el&&el.parentNode){const yPercent=gsap.getProperty(el,"yPercent"),y=gsap.getProperty(el,"y");state.elements[`parallax-${i}`]={selector:'[data-scroll="parallax-component"]',index:i,yPercent:yPercent,y:y}}}),root.querySelectorAll(".next_page_visual").forEach((el,i)=>{if(el&&el.parentNode){const clipPath=gsap.getProperty(el,"clipPath"),y=gsap.getProperty(el,"y");state.elements[`next-visual-${i}`]={selector:".next_page_visual",index:i,clipPath:clipPath,y:y}}}),root.querySelectorAll(".divider_wrap").forEach((el,i)=>{if(el&&el.parentNode){const clipPath=gsap.getProperty(el,"clipPath"),y=gsap.getProperty(el,"y");state.elements[`divider-${i}`]={selector:".divider_wrap",index:i,clipPath:clipPath,y:y}}}),root.querySelectorAll(".info_wrapper").forEach((el,i)=>{if(el&&el.parentNode){const opacity=gsap.getProperty(el,"opacity"),y=gsap.getProperty(el,"y");state.elements[`info-wrapper-${i}`]={selector:".info_wrapper",index:i,opacity:opacity,y:y}}}),root.querySelectorAll(".next_work-info").forEach((el,i)=>{if(el&&el.parentNode){const opacity=gsap.getProperty(el,"opacity"),y=gsap.getProperty(el,"y");state.elements[`next-work-info-${i}`]={selector:".next_work-info",index:i,opacity:opacity,y:y}}}),root.querySelectorAll(".info_divider").forEach((el,i)=>{if(el&&el.parentNode){const height=gsap.getProperty(el,"height"),y=gsap.getProperty(el,"y");state.elements[`info-divider-${i}`]={selector:".info_divider",index:i,height:height,y:y}}}),window._scrollState=state,barbaLog("ScrollTrigger state saved",{scrollTop:state.scrollTop,elementsCount:Object.keys(state.elements).length}),state}function clearScrollTriggerState(){isMobileOrTablet()||window._scrollState&&(barbaLog("ScrollTrigger state cleared"),window._scrollState=null)}function initCaseSmoothScroll(scope){if(isMobileOrTablet())return;const el=(scope||document).querySelector("#scroll");if(!el)return;el._smoothScrollCleanup&&el._smoothScrollCleanup();let currentScroll=el.scrollTop,targetScroll=el.scrollTop,isScrolling=!1,rafId=null,isScrollBlocked=!1;function smoothScroll(){currentScroll+=.065*(targetScroll-currentScroll),el.scrollTop=currentScroll,window.ScrollTrigger&&ScrollTrigger.update(),Math.abs(targetScroll-currentScroll)>.5?rafId=requestAnimationFrame(smoothScroll):(el.scrollTop=targetScroll,isScrolling=!1,rafId=null)}function clampTarget(){const maxScroll=el.scrollHeight-el.clientHeight;targetScroll=Math.max(0,Math.min(targetScroll,Math.max(0,maxScroll)))}function onWheel(e){if(isScrollBlocked)return e.preventDefault(),void e.stopPropagation();e.preventDefault(),e.stopPropagation(),targetScroll+=e.deltaY,clampTarget(),isScrolling||(isScrolling=!0,rafId=requestAnimationFrame(smoothScroll))}function onResize(){clampTarget(),safeScrollTriggerRefresh()}function blockScroll(){isScrollBlocked=!0,barbaLog("Scroll blocked for new container")}function unblockScroll(){isScrollBlocked=!1,barbaLog("Scroll unblocked for new container")}blockScroll(),setTimeout(()=>{unblockScroll()},800),el.addEventListener("wheel",onWheel,{passive:!1}),window.addEventListener("resize",onResize),el._smoothScrollCleanup=function(){el.removeEventListener("wheel",onWheel),window.removeEventListener("resize",onResize),rafId&&cancelAnimationFrame(rafId)},el._blockScroll=blockScroll,el._unblockScroll=unblockScroll}function initCaseScrollTriggers(scope){if(isMobileOrTablet())return;const root=scope||document,scroller=root.querySelector("#scroll");if(!scroller||!window.ScrollTrigger)return;if(scroller._caseSTCleanup&&scroller._caseSTCleanup(),window._scrollState&&window._scrollState.elements){const state=window._scrollState;scroller.scrollTop=state.scrollTop,Object.values(state.elements).forEach(elementState=>{if(elementState.selector&&void 0!==elementState.index){const element=root.querySelectorAll(elementState.selector)[elementState.index];element&&element.parentNode&&(void 0!==elementState.yPercent&&gsap.set(element,{yPercent:elementState.yPercent}),void 0!==elementState.y&&gsap.set(element,{y:elementState.y}),void 0!==elementState.clipPath&&gsap.set(element,{clipPath:elementState.clipPath}),void 0!==elementState.opacity&&gsap.set(element,{opacity:elementState.opacity}),void 0!==elementState.height&&gsap.set(element,{height:elementState.height}))}}),barbaLog("ScrollTrigger state restored",{scrollTop:state.scrollTop,elementsCount:Object.keys(state.elements).length})}const createdTriggers=[],createdTweens=[],globalOnce=scroller._caseGlobalOnce=scroller._caseGlobalOnce||{};root.querySelectorAll('[data-scroll="parallax-hero"]').forEach(parallaxEl=>{const component=parallaxEl.querySelector('[data-scroll="parallax-component"]')||root.querySelector('[data-scroll="parallax-component"]')||document.querySelector('[data-scroll="parallax-component"]');if(!component)return;gsap.set(component,{yPercent:-30});const tw=gsap.to(component,{yPercent:30,ease:"none",immediateRender:!1,scrollTrigger:{trigger:parallaxEl,scroller:scroller,start:"top bottom",end:"bottom top",scrub:.01,invalidateOnRefresh:!0}});tw&&tw.scrollTrigger&&createdTriggers.push(tw.scrollTrigger),tw&&createdTweens.push(tw)}),root.querySelectorAll(".visual_container_btm").forEach(section=>{const nextVisualLocal=section.querySelector(".next_page_visual"),dividerGlobal=section.querySelector(".divider_wrap")||root.querySelector(".divider_wrap")||document.querySelector(".divider_wrap"),infoWrapperGlobal=section.querySelector(".info_wrapper")||root.querySelector(".info_wrapper")||document.querySelector(".info_wrapper"),nextWorkInfoGlobal=section.querySelector(".next_work-info")||root.querySelector(".next_work-info")||document.querySelector(".next_work-info");if(nextVisualLocal){const tw1=gsap.fromTo(nextVisualLocal,{clipPath:"inset(60% 0% 0% 0%)"},{clipPath:"inset(0% 0% 0% 0%)",ease:"none",immediateRender:!1,scrollTrigger:{trigger:section,scroller:scroller,start:"top 50%",end:"30% top",scrub:!0}});tw1&&tw1.scrollTrigger&&createdTriggers.push(tw1.scrollTrigger),tw1&&createdTweens.push(tw1)}if(dividerGlobal&&!globalOnce.divider){const tw2=gsap.fromTo(dividerGlobal,{clipPath:"inset(0% 0% 0% 0%)"},{clipPath:"inset(100% 0% 0% 0%)",ease:"none",immediateRender:!1,scrollTrigger:{trigger:section,scroller:scroller,start:"top 88%",end:"26% top",scrub:!0}});globalOnce.divider=!0,tw2&&tw2.scrollTrigger&&createdTriggers.push(tw2.scrollTrigger),tw2&&createdTweens.push(tw2)}if((infoWrapperGlobal||nextWorkInfoGlobal)&&!globalOnce.infoTl){const tl=gsap.timeline({defaults:{immediateRender:!1},scrollTrigger:{trigger:section,scroller:scroller,start:"top 50%",end:"30% top",scrub:!0}});infoWrapperGlobal&&tl.fromTo(infoWrapperGlobal,{opacity:1},{opacity:.05,ease:"none"},0),nextWorkInfoGlobal&&tl.fromTo(nextWorkInfoGlobal,{opacity:.1},{opacity:1,ease:"none"},0),globalOnce.infoTl=!0,tl.scrollTrigger&&createdTriggers.push(tl.scrollTrigger),createdTweens.push(tl)}let scrollBlockedForSection=!1,userClickedLink=!1;const linkClickHandlers=[];section.querySelectorAll("a[href]").forEach(link=>{const clickHandler=e=>{window.location.pathname!==new URL(link.href,window.location.origin).pathname&&(userClickedLink=!0,barbaLog("Link clicked in visual_container_btm - blocking automatic transition"),setTimeout(()=>{userClickedLink=!1},1500))};link.addEventListener("click",clickHandler,{passive:!0}),linkClickHandlers.push({link:link,handler:clickHandler})});const st=ScrollTrigger.create({trigger:section,scroller:scroller,start:"top 88%",end:"26% top",scrub:!0,onUpdate:self=>{const progressValue=Math.round(100*self.progress),progressEls=section.querySelectorAll('[next-page-scroll="progress"]');(progressEls.length?progressEls:root.querySelectorAll('[next-page-scroll="progress"]').length?root.querySelectorAll('[next-page-scroll="progress"]'):document.querySelectorAll('[next-page-scroll="progress"]')).forEach(el=>{el.textContent=progressValue}),self.progress>=.99&&!scrollBlockedForSection&&scroller&&"function"==typeof scroller._blockScroll&&(scrollBlockedForSection=!0,scroller._blockScroll())},onLeave:()=>{const isBarbaTransitioning=window.barba&&(window.barba.current&&window.barba.current.transition||document.querySelector("[data-barba-container].barba-leave")||document.querySelector("[data-barba-container].barba-enter"));if(window._barbaState.instantNavInProgress||userClickedLink||window.window.archiveTransitionInProgress||isBarbaTransitioning)return void barbaLog("Skipping automatic transition - user interaction or other transition in progress",{instantNavInProgress:window._barbaState.instantNavInProgress,userClickedLink:userClickedLink,archiveTransitionInProgress:window.window.archiveTransitionInProgress,isBarbaTransitioning:isBarbaTransitioning});const nextVisual=section.querySelector(".next_page_visual")||root.querySelector(".next_page_visual")||document.querySelector(".next_page_visual");if(nextVisual){const slugElement=nextVisual.querySelector('[data-next="next-slug"]')||root.querySelector('[data-next="next-slug"]')||document.querySelector('[data-next="next-slug"]');if(slugElement){const slug=slugElement.textContent.trim().toLowerCase().replace(/[\s\W_]+/g,"-").replace(/^-+|-+$/g,"");if(slug){const nextPage=`/${slug}`,transitionType=isMobileOrTablet()?"opacity-crossfade":"fade-transition";barbaLog("Triggering automatic transition via visual_container_btm",{nextPage:nextPage,transitionType:transitionType}),animateLeaveThenGoViaBarba(nextPage,transitionType)}}}}});st._linkClickHandlers=linkClickHandlers,createdTriggers.push(st)}),scroller._caseSTCleanup=function(){createdTriggers.forEach(t=>{t&&t._linkClickHandlers&&t._linkClickHandlers.forEach(({link:link,handler:handler})=>{link.removeEventListener("click",handler)}),t&&t.kill()}),createdTweens.forEach(tw=>{(tw&&tw.targets?tw.targets():[]).forEach(t=>t&&gsap.set(t,{clearProps:"transform,clipPath,opacity"})),tw&&tw.kill()}),scroller._caseGlobalOnce={}},root.querySelectorAll(".info_divider").forEach(divider=>{const tw=gsap.fromTo(divider,{height:"0%"},{height:"100%",ease:"none",immediateRender:!1,scrollTrigger:{trigger:root.querySelector('[data-progress="scroll"]')||divider,scroller:scroller,start:"top bottom",end:"80% top",scrub:!0}});tw&&tw.scrollTrigger&&createdTriggers.push(tw.scrollTrigger),tw&&createdTweens.push(tw)}),root.querySelectorAll(".archive_imgs_wrap").forEach(archiveWrap=>{const lineEl=document.getElementById("archive-line"),lineWrapEl=document.getElementById("archive-line-wrap"),progressElsLocal=archiveWrap.querySelectorAll('[data-scroll="number-progress"]'),progressEls=progressElsLocal.length?progressElsLocal:root.querySelectorAll('[data-scroll="number-progress"]').length?root.querySelectorAll('[data-scroll="number-progress"]'):document.querySelectorAll('[data-scroll="number-progress"]'),archiveImgWraps=archiveWrap.querySelectorAll(".archive_img_wrap"),realHeight=archiveImgWraps.length*window.innerHeight;if(lineEl){const twLine=gsap.fromTo(lineEl,{width:"0%"},{width:"100%",ease:"none",immediateRender:!1,scrollTrigger:{trigger:archiveWrap,scroller:scroller,start:"top bottom",end:`+=${realHeight}`,scrub:!0}});twLine&&twLine.scrollTrigger&&createdTriggers.push(twLine.scrollTrigger),twLine&&createdTweens.push(twLine)}const stProgress=ScrollTrigger.create({trigger:archiveWrap,scroller:scroller,start:"top bottom",end:`+=${realHeight}`,scrub:!0,onUpdate:self=>{const val=Math.round(100*self.progress);progressEls.forEach(el=>{el.textContent=String(val)})}});createdTriggers.push(stProgress);const archiveNameEl=archiveWrap.querySelector('[data-scroll="archive-name"]')||root.querySelector('[data-scroll="archive-name"]')||document.querySelector('[data-scroll="archive-name"]');archiveNameEl&&archiveImgWraps.length>0&&archiveImgWraps.forEach((imgWrap,index)=>{const imgTextEl=imgWrap.querySelector(".archive_img_text"),imgText=imgTextEl?imgTextEl.textContent.trim():null;if(imgText){const stName=ScrollTrigger.create({trigger:imgWrap,scroller:scroller,start:"top center",end:"bottom center",onEnter:()=>{archiveNameEl.textContent=imgText,gsap.fromTo(archiveNameEl,{opacity:0,yPercent:110},{opacity:1,yPercent:0,duration:.5,ease:"expo.out"})},onEnterBack:()=>{archiveNameEl.textContent=imgText,gsap.fromTo(archiveNameEl,{opacity:0,yPercent:110},{opacity:1,yPercent:0,duration:.5,ease:"expo.out"})},onLeave:()=>{gsap.to(archiveNameEl,{opacity:0,yPercent:110,duration:.3,ease:"expo.in"})},onLeaveBack:()=>{gsap.to(archiveNameEl,{opacity:0,yPercent:110,duration:.3,ease:"expo.in"})}});createdTriggers.push(stName)}});let doneOnce=!1;function triggerArchiveAnimation(){if(doneOnce)return;doneOnce=!0,window.window.archiveTransitionInProgress=!0,scroller&&"function"==typeof scroller._blockScroll&&scroller._blockScroll();const titleEl=archiveWrap.querySelectorAll(".archive_progress_number")||root.querySelector(".archive_progress_number")||document.querySelector(".archive_progress_number");titleEl&&gsap.fromTo(titleEl,{yPercent:0},{yPercent:-130,duration:.6,ease:"expo.out"});const countdownEl=archiveWrap.querySelector('[data-scroll="number-gone"]')||root.querySelector('[data-scroll="number-gone"]')||document.querySelector('[data-scroll="number-gone"]'),id=archiveWrap.id||"",nextPage=`/${id.startsWith("next--")?id.replace("next--",""):id}`,tl=gsap.timeline({onComplete:()=>{if(window.window.archiveTransitionInProgress&&nextPage&&"/"!==nextPage)if(window.barba&&"function"==typeof barba.go){const virtualLink=document.createElement("a");virtualLink.href=nextPage,virtualLink.setAttribute("data-barba-link","fade"),virtualLink.style.display="none",document.body.appendChild(virtualLink),virtualLink.click(),setTimeout(()=>{document.body.removeChild(virtualLink)},100)}else window.location.href=nextPage}});if(tl.to({},{duration:.5}),lineWrapEl){tl.addLabel("start");tl.fromTo(lineWrapEl,{clipPath:"inset(0% 0% 0% 0%)"},{clipPath:"inset(0% 0% 0% 100%)",duration:1,ease:"expo.Out"},"start");if(countdownEl){let remaining=2;countdownEl.textContent=String(remaining);const interval=setInterval(()=>{remaining-=1,remaining<=0?(countdownEl.textContent="0",clearInterval(interval)):countdownEl.textContent=String(remaining)},1e3);tl.eventCallback("onComplete",()=>{try{clearInterval(interval)}catch(e){}})}}else if(countdownEl){let remaining=2;countdownEl.textContent=String(remaining);const interval=setInterval(()=>{remaining-=1,countdownEl.textContent=String(Math.max(remaining,0)),remaining<=0&&clearInterval(interval)},1e3);gsap.delayedCall(3,()=>{try{clearInterval(interval)}catch(e){}window.archiveTransitionInProgress&&nextPage&&"/"!==nextPage&&animateLeaveThenGoViaBarba(nextPage,"fade-transition")})}else gsap.delayedCall(1,()=>{window.archiveTransitionInProgress&&nextPage&&"/"!==nextPage&&animateLeaveThenGoViaBarba(nextPage,"fade-transition")});tl.play(),gsap.delayedCall(1.25,()=>{if(window.archiveTransitionInProgress&&nextPage&&"/"!==nextPage)if(window.barba&&"function"==typeof barba.go){const virtualLink=document.createElement("a");virtualLink.href=nextPage,virtualLink.setAttribute("data-barba-link","fade"),virtualLink.style.display="none",document.body.appendChild(virtualLink),virtualLink.click(),setTimeout(()=>{document.body.removeChild(virtualLink)},100)}else window.location.href=nextPage})}const stEnd=ScrollTrigger.create({trigger:archiveWrap,scroller:scroller,start:"bottom bottom",end:"bottom bottom",onEnter:()=>{triggerArchiveAnimation()},onUpdate:self=>{self.progress>=.99&&triggerArchiveAnimation()}}),stEndAlt=ScrollTrigger.create({trigger:archiveWrap,scroller:scroller,start:"top bottom",end:`+=${realHeight}`,onUpdate:self=>{self.progress>=.99&&triggerArchiveAnimation()}});createdTriggers.push(stEndAlt),createdTriggers.push(stEnd)}),safeScrollTriggerRefresh(),setTimeout(()=>safeScrollTriggerRefresh(),0)}function cleanupCaseScrollFeatures(scope){if(isMobileOrTablet())return;const el=(scope||document).querySelector("#scroll");if(!el)return;barbaLog("Cleaning up scroll features",{hasScroll:!!el}),el._smoothScrollCleanup&&(el._smoothScrollCleanup(),el._smoothScrollCleanup=null),el._caseSTCleanup&&(el._caseSTCleanup(),el._caseSTCleanup=null);el.querySelectorAll("[data-scroll], .visual_container_btm, .info_divider").forEach(element=>{gsap.killTweensOf(element)})}